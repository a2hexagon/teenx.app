<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeenX Interactive Mobile UI</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0V4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Define CSS variables for consistent theming */
        :root {
            --red-primary: #e74c3c; /* Main background color */
            --red-dark: #c0392b; /* SOS button background */
            --orange: #f39c12; /* Alerts card color */
            --blue: #3498db; /* Safe Zone card color */
            --purple: #9b59b6; /* Reports card color */
            --green: #2ecc71; /* Tips card color */
            --dark-gray: #34495e; /* Navigation bar background */
            --light-gray: #ecf0f1; /* Navigation item text color */
            --white: #ffffff; /* General text and card background */
            --notification-bg: rgba(0, 0, 0, 0.8); /* Notification bar background */
            --notification-text: #fff; /* Notification text color */
        }

        /* Basic body styling to center the phone container for demonstration */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f2f5; /* Light background for the overall page */
        }

        .phone-container {
            /* Responsive sizing for the phone container */
            width: 90vmin; /* 90% of the smaller of viewport width or height */
            max-width: 360px; /* Max width for larger screens */
            aspect-ratio: 360 / 720; /* Maintain aspect ratio (width:height = 1:2) */
            
            background-color: var(--dark-gray);
            border-radius: 40px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Crucial to contain internal elements */
            position: relative;
            border: 10px solid #222; /* Simulated phone bezel */
        }

        /* Simulated phone notch/speaker area - now responsive */
        .phone-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 28%; /* Relative to container width */
            height: 3.5%; /* Relative to container height */
            background-color: #222;
            border-bottom-left-radius: 15px; /* Fixed radius, could be relative too */
            border-bottom-right-radius: 15px; /* Fixed radius, could be relative too */
            z-index: 10;
        }

        /* Simulated home indicator at the bottom - now responsive */
        .phone-container::after {
            content: '';
            position: absolute;
            bottom: 10px; /* Fixed distance from bottom */
            left: 50%;
            transform: translateX(-50%);
            width: 33%; /* Relative to container width */
            height: 5px; /* Fixed height */
            background-color: #222;
            border-radius: 5px; /* Fixed radius */
        }

        /* Main application screen area */
        .app-screen {
            flex-grow: 1;
            background-color: var(--red-primary);
            display: flex;
            flex-direction: column;
            position: relative;
            padding-top: 25px; /* Space for notch */
        }

        /* Top header bar of the app */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            color: var(--white);
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 5;
        }

        .header .icon {
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* SOS button styling */
        .sos-button {
            background-color: var(--red-dark);
            color: var(--white);
            padding: 15px 20px;
            margin: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .sos-button:active {
            background-color: #a02c20;
        }

        /* Grid layout for feature cards */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 20px;
            margin-bottom: 20px;
        }

        /* Individual feature card styling */
        .feature-card {
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: var(--white);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }

        .feature-card:active {
            transform: scale(0.95);
            background-color: rgba(255, 255, 255, 0.25);
        }

        .feature-card i {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        .feature-card span {
            font-weight: 500;
        }
        
        /* Specific background colors for each feature card */
        .feature-card.alerts { background-color: rgba(243, 156, 18, 0.7); }
        .feature-card.safe-zone { background-color: rgba(52, 152, 219, 0.7); }
        .feature-card.reports { background-color: rgba(155, 89, 182, 0.7); }
        .feature-card.tips { background-color: rgba(46, 204, 113, 0.7); }

        /* Information card styling */
        .info-card {
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 20px;
            margin: 0 20px 20px;
            color: var(--white);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Bottom navigation bar */
        .nav-bar {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background-color: var(--dark-gray);
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.2);
            z-index: 5;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--light-gray);
            font-size: 0.75rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 10px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .nav-item.active {
            color: var(--blue);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        /* Notification Bar: Positioned absolutely at the top, initially hidden */
        .notification-bar {
            position: absolute;
            top: -100px; /* Hidden above the screen */
            left: 0;
            width: 100%;
            background-color: var(--notification-bg);
            color: var(--notification-text);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: top 0.3s ease-out, transform 0.3s ease-out; /* Smooth slide in/out */
            z-index: 100;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: grab;
        }

        .notification-bar.show {
            top: 0; /* Visible at the top */
        }

        .notification-bar .icon {
            font-size: 1.5rem;
            color: var(--blue);
        }

        .notification-bar .content {
            flex-grow: 1;
        }
        
        /* Modal / Popup Styles */
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }

        .modal {
            background: var(--white);
            color: #333;
            padding: 25px;
            border-radius: 20px;
            width: 85%;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            display: flex; /* Added for flex layout of modal content */
            flex-direction: column; /* Added for flex layout of modal content */
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2rem;
            color: #aaa;
            cursor: pointer;
            line-height: 1;
        }

        .modal h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: var(--dark-gray);
        }

        .modal p {
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        #download-button, #generate-tips-button, #generate-report-button, .sos-confirm-button {
            width: 100%;
            padding: 12px;
            background-color: var(--blue);
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px; /* Added margin for spacing */
        }

        #download-button:hover, #generate-tips-button:hover, #generate-report-button:hover, .sos-confirm-button:hover {
            background-color: #2980b9;
        }

        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            display: none; /* Hidden by default */
            margin-top: 15px; /* Added margin for spacing */
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background-color: var(--green);
            border-radius: 10px;
            transition: width 0.2s linear;
        }
        
        #thank-you-message {
            text-align: center;
            font-weight: bold;
            color: var(--green);
            display: none; /* Hidden by default */
            margin-top: 15px; /* Added margin for spacing */
        }

        /* Styles for the new AI sections */
        .ai-section, .feature-demo-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: none; /* Hidden by default, shown by JS */
            flex-direction: column;
            gap: 10px;
        }

        .ai-section label, .feature-demo-section label {
            font-weight: bold;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .ai-section textarea, .ai-section select {
            width: calc(100% - 20px); /* Adjust for padding */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 0.9rem;
            resize: vertical; /* Allow vertical resizing */
            min-height: 40px; /* Adjusted min-height for select */
            max-height: 120px;
            box-sizing: border-box; /* Include padding in width calculation */
        }

        .ai-output, .demo-output {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            min-height: 80px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #555;
            white-space: pre-wrap; /* Preserve whitespace and wrap text */
            margin-top: 10px;
            display: none; /* Hidden by default */
        }

        .loading-indicator {
            text-align: center;
            margin-top: 10px;
            font-style: italic;
            color: #666;
            display: none; /* Hidden by default */
        }

        /* Styles for the final download prompt section */
        .final-download-section {
            background-color: var(--white);
            color: var(--dark-gray);
            padding: 20px;
            margin: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none; /* Hidden by default */
        }

        .final-download-section h3 {
            margin-top: 0;
            color: var(--blue);
        }

        #final-download-button {
            width: 100%;
            padding: 12px;
            background-color: var(--green); /* Different color for distinction */
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 15px;
        }

        #final-download-button:hover {
            background-color: #27ae60;
        }

        #final-progress-container {
            margin-top: 15px;
        }

        #final-thank-you-message {
            margin-top: 15px;
        }

        /* SOS Confirmation Modal Specific Styles */
        #sos-confirm-modal {
            background: var(--white);
            color: #333;
            padding: 25px;
            border-radius: 20px;
            width: 85%;
            max-width: 280px; /* Slightly smaller for SOS */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        #sos-confirm-modal h3 {
            color: var(--red-dark);
            margin-bottom: 20px;
        }

        #sos-confirm-modal .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        #sos-confirm-modal .button-group button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #sos-confirm-yes {
            background-color: var(--red-dark);
            color: var(--white);
            border: none;
        }

        #sos-confirm-yes:hover {
            background-color: #a02c20;
        }

        #sos-confirm-cancel {
            background-color: #ccc;
            color: #333;
            border: none;
        }

        #sos-confirm-cancel:hover {
            background-color: #bbb;
        }

        /* Styles for the new floating download prompt */
        .floating-download-section {
            position: fixed; /* Fixed position relative to viewport */
            bottom: 50px; /* Distance from bottom */
            right: 50px; /* Distance from right */
            background-color: var(--white);
            color: var(--dark-gray);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none; /* Hidden by default */
            width: 280px; /* Fixed width */
            z-index: 300; /* Above other elements */
            flex-direction: column; /* For internal layout */
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.3s ease-out, opacity 0.3s ease-out; /* Smooth transitions */
        }

        .floating-download-section .cancel-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #333;
            color: var(--white);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .floating-download-section button {
            background: linear-gradient(45deg, var(--green), #27ae60); /* Green gradient */
            box-shadow: 0 4px 10px rgba(46, 204, 113, 0.4); /* Green shadow */
            color: var(--white);
            font-size: 1.1rem;
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .floating-download-section button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(46, 204, 113, 0.6);
        }

        .floating-download-section button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(46, 204, 113, 0.3);
        }

        /* Responsive adjustments for the floating prompt */
        @media (max-width: 900px) { /* Adjust breakpoint as needed for when it moves below the phone */
            .floating-download-section {
                width: 80%; /* Make it wider on smaller screens */
                max-width: 300px; /* Prevent it from getting too wide */
                left: 50%; /* Center horizontally */
                right: auto; /* Remove right positioning */
                transform: translateX(-50%); /* Center horizontally */
                bottom: 20px; /* Closer to the bottom */
            }
        }
    </style>
</head>
<body>
    <!-- Main container for the simulated phone device -->
    <div class="phone-container">
        <!-- The actual app screen content -->
        <div class="app-screen">
            <!-- App Header -->
            <div class="header">
                <i class="fas fa-bars icon" id="menu-icon" aria-label="Open menu"></i>
                <span>TeenX</span>
                <i class="fas fa-sign-out-alt icon" id="logout-icon" aria-label="Logout"></i>
            </div>

            <!-- SOS Button: Prominent call to action -->
            <div class="sos-button" id="sos-button" role="button" aria-label="Send SOS emergency alert">
                <i class="fas fa-exclamation-triangle"></i>
                <span>SOS</span>
            </div>

            <!-- Feature Grid: Interactive buttons for different app sections -->
            <div class="feature-grid">
                <!-- Data attributes store modal content for each card -->
                <div class="feature-card alerts" data-modal-title="Alerts Feature" data-modal-message="View and manage safety alerts from your community. Download the latest alert summary report below." role="button" aria-label="View Alerts">
                    <i class="fas fa-bell"></i>
                    <span>Alerts</span>
                </div>
                <div class="feature-card safe-zone" data-modal-title="Safe Zone" data-modal-message="Define your safe zones and get notified when you enter or leave them. You can download your zone configuration." role="button" aria-label="Manage Safe Zones">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Safe Zone</span>
                </div>
                <div class="feature-card reports" data-modal-title="Incident Reports" data-modal-message="Submit and track incident reports anonymously. Your privacy is our priority. Download a template for detailed reporting." role="button" aria-label="Submit Incident Reports">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Reports</span>
                </div>
                <div class="feature-card tips" data-modal-title="Safety Tips" data-modal-message="Access a library of safety tips and resources to stay informed and secure. Download our complete safety guide." role="button" aria-label="Get Safety Tips">
                    <i class="fas fa-lightbulb"></i>
                    <span>Tips</span>
                </div>
            </div>

            <!-- Information Card -->
            <div class="info-card">
                <p><strong>Current Location:</strong> Dhaka, Bangladesh</p>
                <p><strong>Last Alert:</strong> No new alerts</p>
                <p><strong>Safety Tip:</strong> Trust your instincts. If a situation feels unsafe, it probably is.</p>
            </div>

            <!-- Final Download Prompt Section (appears after all features interacted) -->
            <div id="final-download-prompt" class="final-download-section">
                <h3>Experience the Full App!</h3>
                <p>You've explored the core features. Download the TeenX app now for real-time alerts, personalized safe zones, and more!</p>
                <button id="final-download-button" aria-label="Download TeenX App Now">Download TeenX Now!</button>
                <div class="progress-container" id="final-progress-container">
                    <div class="progress-bar" id="final-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p id="final-thank-you-message">Thanks for downloading!</p>
            </div>
        </div>

        <!-- Bottom Navigation Bar -->
        <div class="nav-bar">
            <div class="nav-item active" role="link" aria-label="Home">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" role="link" aria-label="Community">
                <i class="fas fa-users"></i>
                <span>Community</span>
            </div>
            <div class="nav-item" role="link" aria-label="Blog">
                <i class="fas fa-book-open"></i>
                <span>Blog</span>
            </div>
        </div>

        <!-- Notification Bar: This element slides down from the top -->
        <div id="notification-bar" class="notification-bar" role="status" aria-live="polite">
            <i class="fas fa-info-circle icon"></i>
            <div class="content">
                <strong id="notification-title"></strong>
                <span id="notification-message"></span>
            </div>
        </div>

        <!-- Main Feature Modal / Popup -->
        <div id="modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div id="modal" class="modal">
                <button class="close-button" id="modal-close-button" aria-label="Close modal">&times;</button>
                <h3 id="modal-title"></h3>
                <p id="modal-message"></p>
                <div id="modal-action-area">
                    <!-- Feature Demo Sections -->
                    <div class="feature-demo-section" id="alerts-demo-section">
                        <h4>Recent Alerts:</h4>
                        <div class="demo-output" style="display: block;">
                            <p><strong>Emergency Alert:</strong> Suspicious activity reported near Central Park. Stay vigilant!</p>
                            <p><strong>Community Update:</strong> Missing pet alert in Northwood area. Keep an eye out!</p>
                            <p><strong>Safety Advisory:</strong> Road closure on Main Street due to maintenance. Use alternate routes.</p>
                        </div>
                    </div>

                    <div class="feature-demo-section" id="safe-zone-demo-section">
                        <h4>Your Current Safe Zone:</h4>
                        <div class="demo-output" style="display: block;">
                            <p><strong>Zone Name:</strong> Home Area</p>
                            <p><strong>Location:</strong> 23.8103° N, 90.4125° E (Dhaka, Bangladesh)</p>
                            <p><strong>Radius:</strong> 500 meters</p>
                            <p>You will be notified when you enter or leave this zone.</p>
                            <p><em>(Map visualization not available in simulation)</em></p>
                        </div>
                    </div>

                    <!-- AI Tip Generation Section -->
                    <div class="ai-section" id="ai-tip-section">
                        <label for="tips-category">Select Category (Optional):</label>
                        <select id="tips-category" class="category-select" aria-label="Select safety tip category">
                            <option value="">Any</option>
                            <option value="online safety">Online Safety</option>
                            <option value="stranger danger">Stranger Danger</option>
                            <option value="bullying">Bullying</option>
                            <option value="mental health">Mental Health</option>
                            <option value="personal boundaries">Personal Boundaries</option>
                        </select>
                        <label for="tips-input">Or describe a topic:</label>
                        <textarea id="tips-input" placeholder="e.g., online safety, dealing with bullies, walking alone" aria-label="Enter topic for safety tips"></textarea>
                        <button id="generate-tips-button" aria-label="Generate Safety Tips">Generate Tips ✨</button>
                        <div class="loading-indicator" id="ai-tips-loading-indicator" aria-live="assertive">Generating tips...</div>
                        <div id="ai-tips-output" class="ai-output"></div>
                    </div>

                    <!-- AI Report Drafting Section -->
                    <div class="ai-section" id="ai-report-section">
                        <label for="report-input">Describe the incident:</label>
                        <textarea id="report-input" placeholder="e.g., I saw someone suspicious near the school gate yesterday." aria-label="Describe the incident"></textarea>
                        <button id="generate-report-button" aria-label="Draft Incident Report">Draft Report ✨</button>
                        <div class="loading-indicator" id="ai-report-loading-indicator" aria-live="assertive">Drafting report...</div>
                        <div id="ai-report-output" class="ai-output"></div>
                    </div>

                    <button id="download-button" aria-label="Download file">Download</button>
                    <div class="progress-container" id="progress-container">
                        <div class="progress-bar" id="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p id="thank-you-message">Thanks for downloading!</p>
                </div>
            </div>
        </div>

        <!-- SOS Confirmation Modal -->
        <div id="sos-confirm-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="sos-confirm-modal-title">
            <div id="sos-confirm-modal" class="modal">
                <h3 id="sos-confirm-modal-title">Confirm SOS Alert</h3>
                <p>Are you sure you want to send an SOS alert to your emergency contacts?</p>
                <div class="button-group">
                    <button id="sos-confirm-yes" aria-label="Yes, send SOS">Yes, Send SOS</button>
                    <button id="sos-confirm-cancel" aria-label="Cancel SOS">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- First Interaction Download Prompt Section - Now outside the phone container -->
    <div id="first-interaction-download-prompt" class="floating-download-section">
        <button class="cancel-button" id="first-interaction-cancel-button" aria-label="Dismiss download prompt">&times;</button>
        <h3>Want the Real Experience?</h3>
        <p>This is just a simulation. Download the full TeenX app to get real-time safety features and support!</p>
        <button id="first-interaction-download-button" aria-label="Download TeenX App Now">Download TeenX Now!</button>
        <div class="progress-container" id="first-interaction-progress-container">
            <div class="progress-bar" id="first-interaction-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <p id="first-interaction-thank-you-message">Thanks for downloading!</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const menuIcon = document.getElementById('menu-icon');
            const logoutIcon = document.getElementById('logout-icon');
            const sosButton = document.getElementById('sos-button');
            const featureCards = document.querySelectorAll('.feature-card');
            const notificationBar = document.getElementById('notification-bar');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');

            const modalOverlay = document.getElementById('modal-overlay');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseButton = document.getElementById('modal-close-button');
            const downloadButton = document.getElementById('download-button');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const thankYouMessage = document.getElementById('thank-you-message');

            // Feature Demo elements
            const alertsDemoSection = document.getElementById('alerts-demo-section');
            const safeZoneDemoSection = document.getElementById('safe-zone-demo-section');

            // AI specific elements for Tips
            const aiTipSection = document.getElementById('ai-tip-section');
            const tipsCategorySelect = document.getElementById('tips-category');
            const tipsInput = document.getElementById('tips-input');
            const generateTipsButton = document.getElementById('generate-tips-button');
            const aiTipsLoadingIndicator = document.getElementById('ai-tips-loading-indicator');
            const aiTipsOutput = document.getElementById('ai-tips-output');

            // AI specific elements for Reports
            const aiReportSection = document.getElementById('ai-report-section');
            const reportInput = document.getElementById('report-input');
            const generateReportButton = document.getElementById('generate-report-button');
            const aiReportLoadingIndicator = document.getElementById('ai-report-loading-indicator');
            const aiReportOutput = document.getElementById('ai-report-output');

            // Final Download Prompt elements (for "all features interacted")
            const finalDownloadPrompt = document.getElementById('final-download-prompt');
            const finalDownloadButton = document.getElementById('final-download-button');
            const finalProgressContainer = document.getElementById('final-progress-container');
            const finalProgressBar = document.getElementById('final-progress-bar');
            const finalThankYouMessage = document.getElementById('final-thank-you-message');

            // First Interaction Download Prompt elements
            const firstInteractionDownloadPrompt = document.getElementById('first-interaction-download-prompt');
            const firstInteractionDownloadButton = document.getElementById('first-interaction-download-button');
            const firstInteractionProgressContainer = document.getElementById('first-interaction-progress-container');
            const firstInteractionProgressBar = document.getElementById('first-interaction-progress-bar');
            const firstInteractionThankYouMessage = document.getElementById('first-interaction-thank-you-message');
            const firstInteractionCancelButton = document.getElementById('first-interaction-cancel-button'); // New cancel button

            // SOS Confirmation Modal elements
            const sosConfirmOverlay = document.getElementById('sos-confirm-overlay');
            const sosConfirmYesButton = document.getElementById('sos-confirm-yes');
            const sosConfirmCancelButton = document.getElementById('sos-confirm-cancel');

            // --- Feature Interaction Tracking ---
            const featureInteracted = {
                sos: false,
                alerts: false,
                safeZone: false,
                reports: false,
                tips: false
            };
            let hasInteractedOnce = false; // Flag for the first interaction download prompt

            function checkAllFeaturesInteracted() {
                const allInteracted = Object.values(featureInteracted).every(status => status === true);
                if (allInteracted) {
                    finalDownloadPrompt.style.display = 'block';
                }
            }

            // Function to trigger the first interaction download prompt
            function triggerFirstInteractionDownloadPrompt() {
                if (hasInteractedOnce) return; // Only show once
                hasInteractedOnce = true;

                setTimeout(() => {
                    firstInteractionDownloadPrompt.style.display = 'flex'; // Use flex to show it
                    // Reset its state
                    firstInteractionDownloadButton.style.display = 'block';
                    firstInteractionProgressContainer.style.display = 'none';
                    firstInteractionThankYouMessage.style.display = 'none';
                    firstInteractionProgressBar.style.width = '0%';
                }, 2000); // 2-second delay
            }

            // --- Notification Logic ---
            let notificationTimeout;
            let startY, currentY, startX, currentX;
            let isSwiping = false;
            let swipeDirection = ''; // 'vertical' or 'horizontal'
            
            // Global function to show notifications
            window.showNotification = (title, message) => {
                clearTimeout(notificationTimeout); // Clear any existing timer
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                
                // Ensure initial state is ready for transition
                notificationBar.style.top = '-100px'; // Start from hidden
                notificationBar.style.transform = 'translateX(0)'; // Start from center
                notificationBar.style.transition = 'none'; // Disable transition for immediate reset
                // Force reflow to apply 'none' before setting 'show'
                notificationBar.offsetHeight; 
                notificationBar.style.transition = 'top 0.3s ease-out, transform 0.3s ease-out'; // Re-enable transition
                
                notificationBar.classList.add('show'); // Show it

                notificationTimeout = setTimeout(hideNotificationComplete, 5000);
            }

            function hideNotificationComplete() {
                notificationBar.classList.remove('show');
                // Reset properties after the transition finishes to ensure it's ready for the next show
                notificationBar.style.top = '-100px'; 
                notificationBar.style.transform = 'translateX(0)';
                clearTimeout(notificationTimeout); // Clear any pending timeout
            }

            // Notification Touch Event Listeners
            notificationBar.addEventListener('touchstart', (e) => {
                if (!notificationBar.classList.contains('show')) return;
                startY = e.touches[0].clientY;
                startX = e.touches[0].clientX;
                isSwiping = true;
                swipeDirection = ''; // Reset direction
                notificationBar.style.transition = 'none'; // Disable transition for direct control
                clearTimeout(notificationTimeout); // Clear auto-hide on touch
            }, { passive: true }); // Keep passive true for touchstart

            notificationBar.addEventListener('touchmove', (e) => {
                if (!isSwiping) return;

                currentY = e.touches[0].clientY;
                currentX = e.touches[0].clientX;
                const deltaY = currentY - startY;
                const deltaX = currentX - startX;

                // Determine swipe direction on first significant movement
                if (swipeDirection === '') {
                    if (Math.abs(deltaY) > 10 && Math.abs(deltaY) > Math.abs(deltaX)) {
                        swipeDirection = 'vertical';
                    } else if (Math.abs(deltaX) > 10) {
                        swipeDirection = 'horizontal';
                    }
                }

                if (swipeDirection === 'vertical') {
                    // Only allow swiping up (negative deltaY)
                    if (deltaY < 0) {
                        notificationBar.style.top = `${deltaY}px`;
                        e.preventDefault(); // Prevent page scroll
                    }
                } else if (swipeDirection === 'horizontal') {
                    notificationBar.style.transform = `translateX(${deltaX}px)`;
                    e.preventDefault(); // Prevent page scroll
                }
            }, { passive: false }); // Set passive false for touchmove

            notificationBar.addEventListener('touchend', () => {
                if (!isSwiping) return;
                isSwiping = false;
                notificationBar.style.transition = 'top 0.3s ease-out, transform 0.3s ease-out';

                const deltaY = currentY - startY;
                const deltaX = currentX - startX;

                if (swipeDirection === 'vertical') {
                    // If swiped up enough, hide it
                    if (deltaY < -40) {
                        hideNotificationComplete();
                    } else {
                        // Otherwise, snap back to the top
                        notificationBar.style.top = '0px';
                    }
                } else if (swipeDirection === 'horizontal') {
                    // If swiped horizontally enough, dismiss it
                    if (Math.abs(deltaX) > 80) {
                        // Animate it off-screen
                        notificationBar.style.transform = `translateX(${deltaX > 0 ? '100%' : '-100%'})`;
                        // After animation, properly hide it
                        notificationBar.addEventListener('transitionend', hideNotificationComplete, { once: true });
                    } else {
                        // Otherwise, snap back to center
                        notificationBar.style.transform = 'translateX(0)';
                    }
                }
            });

            // --- Main Feature Modal Logic ---
            function showModal(title, message, cardType) {
                modalTitle.textContent = title;
                modalMessage.textContent = message;

                // Reset modal state
                downloadButton.style.display = 'block';
                progressContainer.style.display = 'none';
                thankYouMessage.style.display = 'none';
                progressBar.style.width = '0%';
                
                // Hide all AI/Demo sections by default
                aiTipSection.style.display = 'none';
                aiReportSection.style.display = 'none';
                alertsDemoSection.style.display = 'none';
                safeZoneDemoSection.style.display = 'none';

                // Conditionally show sections based on card type
                if (cardType === 'tips') {
                    aiTipSection.style.display = 'flex';
                    tipsCategorySelect.value = ''; // Clear category selection
                    tipsInput.value = ''; // Clear previous input
                    aiTipsOutput.textContent = ''; // Clear previous output
                    aiTipsOutput.style.display = 'none';
                    aiTipsLoadingIndicator.style.display = 'none';
                } else if (cardType === 'reports') {
                    aiReportSection.style.display = 'flex';
                    reportInput.value = ''; // Clear previous input
                    aiReportOutput.textContent = ''; // Clear previous output
                    aiReportOutput.style.display = 'none';
                    aiReportLoadingIndicator.style.display = 'none';
                } else if (cardType === 'alerts') {
                    alertsDemoSection.style.display = 'flex';
                } else if (cardType === 'safe-zone') {
                    safeZoneDemoSection.style.display = 'flex';
                }

                modalOverlay.classList.add('show');
            }

            function hideModal() {
                modalOverlay.classList.remove('show');
            }

            // --- SOS Confirmation Modal Logic ---
            function showSOSConfirmationModal() {
                sosConfirmOverlay.classList.add('show');
            }

            function hideSOSConfirmationModal() {
                sosConfirmOverlay.classList.remove('show');
            }

            // --- Event Listeners for App Features ---
            menuIcon.addEventListener('click', () => {
                showNotification('Menu Clicked', 'This would open the side menu.');
                triggerFirstInteractionDownloadPrompt();
            });

            logoutIcon.addEventListener('click', () => {
                showNotification('Logout', 'You have been logged out.');
                triggerFirstInteractionDownloadPrompt();
            });

            sosButton.addEventListener('click', () => {
                showSOSConfirmationModal(); // Show confirmation modal instead of direct notification
            });

            sosConfirmYesButton.addEventListener('click', () => {
                hideSOSConfirmationModal();
                featureInteracted.sos = true;
                showNotification('SOS Activated!', 'Emergency contacts have been notified.');
                checkAllFeaturesInteracted();
                triggerFirstInteractionDownloadPrompt(); // Trigger after confirmed SOS
            });

            sosConfirmCancelButton.addEventListener('click', () => {
                hideSOSConfirmationModal();
                showNotification('SOS Canceled', 'Your SOS alert was canceled.');
                triggerFirstInteractionDownloadPrompt(); // Trigger after canceling SOS
            });

            // Close SOS confirmation modal if clicking outside
            sosConfirmOverlay.addEventListener('click', (e) => {
                if (e.target === sosConfirmOverlay) {
                    hideSOSConfirmationModal();
                }
            });

            featureCards.forEach(card => {
                card.addEventListener('click', () => {
                    const title = card.dataset.modalTitle;
                    const message = card.dataset.modalMessage;
                    let cardType = '';
                    if (card.classList.contains('alerts')) {
                        featureInteracted.alerts = true;
                        cardType = 'alerts';
                        showNotification('New Alert!', 'Suspicious activity reported near Central Park.'); // Specific alert notification
                    } else if (card.classList.contains('safe-zone')) {
                        featureInteracted.safeZone = true;
                        cardType = 'safe-zone';
                    } else if (card.classList.contains('reports')) {
                        featureInteracted.reports = true;
                        cardType = 'reports';
                    } else if (card.classList.contains('tips')) {
                        featureInteracted.tips = true;
                        cardType = 'tips';
                    }
                    showModal(title, message, cardType);
                    checkAllFeaturesInteracted();
                    triggerFirstInteractionDownloadPrompt(); // Trigger after any feature card click
                });
            });

            modalCloseButton.addEventListener('click', hideModal);
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    hideModal();
                }
            });

            // --- Modal Download Simulation Logic ---
            downloadButton.addEventListener('click', () => {
                // Set aria-valuenow for screen readers
                progressBar.setAttribute('aria-valuenow', '0');

                // Simulate download by creating a temporary anchor tag and clicking it
                const downloadLink = document.createElement('a');
                downloadLink.href = "Assets/App/TeenXApp.apk"; // Set the download link
                downloadLink.download = "TeenXApp.apk"; // Suggest a filename
                document.body.appendChild(downloadLink); // Append to body (required for Firefox)
                downloadLink.click(); // Programmatically click the link
                document.body.removeChild(downloadLink); // Remove the link after clicking

                downloadButton.style.display = 'none';
                progressContainer.style.display = 'block';
                
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 100) {
                        clearInterval(interval);
                        progressContainer.style.display = 'none';
                        thankYouMessage.style.display = 'block';
                        // Update aria-valuenow to 100 on completion
                        progressBar.setAttribute('aria-valuenow', '100');
                        // Optionally hide the modal after a short delay
                        setTimeout(hideModal, 2000); 
                    } else {
                        width++;
                        progressBar.style.width = width + '%';
                        // Update aria-valuenow during progress
                        progressBar.setAttribute('aria-valuenow', width.toString());
                    }
                }, 20); // 20ms interval for a smooth 2-second progress
            });

            // --- Gemini API Integration for Safety Tips ---
            generateTipsButton.addEventListener('click', async () => {
                const category = tipsCategorySelect.value;
                const freeformPrompt = tipsInput.value.trim();
                
                let promptText = '';
                if (category && freeformPrompt) {
                    promptText = `Provide 3-5 concise safety tips for a teenager regarding the category "${category}" and specifically about: ${freeformPrompt}`;
                } else if (category) {
                    promptText = `Provide 3-5 concise safety tips for a teenager regarding the category "${category}".`;
                } else if (freeformPrompt) {
                    promptText = `Provide 3-5 concise safety tips for a teenager regarding: ${freeformPrompt}`;
                } else {
                    showNotification('Input Required', 'Please select a category or enter a topic for safety tips.');
                    return;
                }

                aiTipsOutput.textContent = ''; // Clear previous tips
                aiTipsOutput.style.display = 'none';
                aiTipsLoadingIndicator.style.display = 'block'; // Show loading indicator

                let retries = 0;
                const maxRetries = 3;
                const baseDelay = 1000; // 1 second

                while (retries < maxRetries) {
                    try {
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: promptText }] });
                        const payload = { contents: chatHistory };
                        const apiKey = "AIzaSyCqDwu5H5f1PjfYbq00B2b23m2P0zVK8vM"; // Canvas will automatically provide the API key
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            aiTipsOutput.textContent = text;
                            aiTipsOutput.style.display = 'block';
                        } else {
                            aiTipsOutput.textContent = 'Could not generate tips. Please try again.';
                            aiTipsOutput.style.display = 'block';
                        }
                        break; // Exit loop on success
                    } catch (error) {
                        console.error('Error generating tips:', error);
                        retries++;
                        if (retries < maxRetries) {
                            const delay = baseDelay * Math.pow(2, retries - 1); // Exponential backoff
                            await new Promise(resolve => setTimeout(resolve, delay));
                        } else {
                            aiTipsOutput.textContent = 'Failed to generate tips after multiple attempts. Please try again later.';
                            aiTipsOutput.style.display = 'block';
                        }
                    } finally {
                        aiTipsLoadingIndicator.style.display = 'none'; // Hide loading indicator
                    }
                }
            });

            // --- Gemini API Integration for Report Drafting ---
            generateReportButton.addEventListener('click', async () => {
                const prompt = reportInput.value.trim();
                if (!prompt) {
                    showNotification('Input Required', 'Please describe the incident to draft a report.');
                    return;
                }

                aiReportOutput.textContent = ''; // Clear previous report
                aiReportOutput.style.display = 'none';
                aiReportLoadingIndicator.style.display = 'block'; // Show loading indicator

                let retries = 0;
                const maxRetries = 3;
                const baseDelay = 1000; // 1 second

                while (retries < maxRetries) {
                    try {
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: `Draft a concise incident report based on the following description, focusing on key details like who, what, when, where, and how. If any information is missing, suggest what else might be needed. Incident description: "${prompt}"` }] });
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // Canvas will automatically provide the API key
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();
                        
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            const text = result.candidates[0].content.parts[0].text;
                            aiReportOutput.textContent = text;
                            aiReportOutput.style.display = 'block';
                        } else {
                            aiReportOutput.textContent = 'Could not draft report. Please try again.';
                            aiReportOutput.style.display = 'block';
                        }
                        break; // Exit loop on success
                    } catch (error) {
                        console.error('Error drafting report:', error);
                        retries++;
                        if (retries < maxRetries) {
                            const delay = baseDelay * Math.pow(2, retries - 1); // Exponential backoff
                            await new Promise(resolve => setTimeout(resolve, delay));
                        } else {
                            aiReportOutput.textContent = 'Failed to draft report after multiple attempts. Please try again later.';
                            aiReportOutput.style.display = 'block';
                        }
                    } finally {
                        aiReportLoadingIndicator.style.display = 'none'; // Hide loading indicator
                    }
                }
            });

            // --- First Interaction App Download Logic ---
            firstInteractionDownloadButton.addEventListener('click', () => {
                // Set aria-valuenow for screen readers
                firstInteractionProgressBar.setAttribute('aria-valuenow', '0');

                const downloadLink = document.createElement('a');
                downloadLink.href = "Assets/App/TeenXApp.apk";
                downloadLink.download = "TeenXApp.apk";
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                firstInteractionDownloadButton.style.display = 'none';
                firstInteractionProgressContainer.style.display = 'block';
                
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 100) {
                        clearInterval(interval);
                        firstInteractionProgressContainer.style.display = 'none';
                        firstInteractionThankYouMessage.style.display = 'block';
                        // Update aria-valuenow to 100 on completion
                        firstInteractionProgressBar.setAttribute('aria-valuenow', '100');
                        setTimeout(() => {
                            firstInteractionDownloadPrompt.style.display = 'none'; // Hide after download
                        }, 2000);
                    } else {
                        width++;
                        firstInteractionProgressBar.style.width = width + '%';
                        // Update aria-valuenow during progress
                        firstInteractionProgressBar.setAttribute('aria-valuenow', width.toString());
                    }
                }, 20);
            });

            // --- Cancel First Interaction Download Prompt ---
            firstInteractionCancelButton.addEventListener('click', () => {
                firstInteractionDownloadPrompt.style.display = 'none';
                hasInteractedOnce = true; // Ensure it doesn't reappear
            });

            // --- Final App Download Logic (after all features interacted) ---
            finalDownloadButton.addEventListener('click', () => {
                // Set aria-valuenow for screen readers
                finalProgressBar.setAttribute('aria-valuenow', '0');

                const downloadLink = document.createElement('a');
                downloadLink.href = "Assets/App/TeenXApp.apk";
                downloadLink.download = "TeenXApp.apk";
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);

                finalDownloadButton.style.display = 'none';
                finalProgressContainer.style.display = 'block';
                
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 100) {
                        clearInterval(interval);
                        finalProgressContainer.style.display = 'none';
                        finalThankYouMessage.style.display = 'block';
                        // Update aria-valuenow to 100 on completion
                        finalProgressBar.setAttribute('aria-valuenow', '100');
                    } else {
                        width++;
                        finalProgressBar.style.width = width + '%';
                        // Update aria-valuenow during progress
                        finalProgressBar.setAttribute('aria-valuenow', width.toString());
                    }
                }, 20);
            });
        });
    </script>
</body>
</html>
